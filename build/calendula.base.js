var Calendula=function(t,e){"use strict";function n(t){return(10>t?"0":"")+t}function i(t){return(t%4||!(t%100))&&t%400?!1:!0}var o="calendula",r=0,s=11,a=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},h=function(t){t=a({},t||{});var e=this._prepareYears(t.years),n=this;this._data=a(t,{autoclose:"undefined"==typeof t.autoclose?!0:t.autoclose,closeAfterSelection:"undefined"==typeof t.closeAfterSelection?!0:t.closeAfterSelection,locale:t.locale||h._defaultLocale,theme:t.theme||"default",min:this._parseDateToObj(t.min),max:this._parseDateToObj(t.max),_startYear:e.start,_endYear:e.end}),this._domEvent=new $,this.val(this._data.value);var i=this.setting("button");i&&this._domEvent.on(i,"click",function(){n.toggle()},"init")};h.version="0.9.0",a(h.prototype,{isOpened:function(){return this._isOpened},open:function(){var t=this;return this._init(),this._ignoreDocumentClick=!0,this.isOpened()||(this._timeout.set(function(){d(t._container,c("opened")),t._update(),t._monthSelector(t._currentDate.month,!1),t._yearSelector(t._currentDate.year,!1),t._openedEvents()},1,"open"),this._isOpened=!0,this.trigger("open")),this},close:function(){return this._init(),this.isOpened()&&(this._ignoreDocumentClick=!1,this._timeout.clearAll("open"),this._update(),this._delOpenedEvents(),m(this._container,c("opened")),this._isOpened=!1,this.trigger("close")),this},toggle:function(){return this.isOpened()?this.close():this.open(),this},val:function(t){return arguments.length?(t?(this._val=this._parseDateToObj(t),this._currentDate=a({},this._val)):(this._val={},this._currentDate=this._current()),this._container&&this._updateSelection(),void this._updateButton()):this._val},setting:function(t,e){if(1===arguments.length)return this._data[t];var n,i=this._data[t],o=this._container,r={min:!0,max:!0,locale:!0};return this._data[t]="min"===t||"max"===t||"value"===t?this._parseDateToObj(e):e,o&&("theme"===t&&(m(o,c("theme",i)),d(o,c("theme",e))),"daysAfterMonths"===t&&(n=c("days-after-months"),e?d(o,n):m(o,n)),r[t]&&this._rebuild()),this},destroy:function(){this._isInited&&(this.close(),this._timeout.clearAll(),this._eventBuf=[],this._domEvent.offAll(),e.body.removeChild(this._container),["_container","_data","_domEvent","_ignoreDocumentClick","_isInited","_isOpened","_timeout"].forEach(function(t){delete this[t]},this))},_init:function(){if(!this._isInited){this._isInited=!0,this._timeout=new D,this._templates.parent=this;var t=this.setting("id"),n=e.createElement("div");this._container=n,t&&(n.id=t),d(n,o),d(n,c("theme",this._data.theme)),this.setting("daysAfterMonths")&&d(n,c("days-after-months")),this._rebuild(),e.body.appendChild(n)}},_current:function(){var t=new Date;return{day:t.getDate(),month:t.getMonth(),year:t.getFullYear()}},_update:function(){this._init();var t,e=this.setting("button");e&&(t=this._offset(e),t.top+=e.offsetHeight,this._position(this._container,t))},_resize:function(){this._update()},_rebuild:function(){this._container.innerHTML=this.template("main")},_rebuildDays:function(){this._elem("days-container").innerHTML=this.template("days"),this._monthSelector(this._currentDate.month,!1)},_openedEvents:function(){var n=this;this._ignoreDocumentClick=!1,this._domEvent.on(e,"click",function(t){!t.button&&n.setting("autoclose")&&(n._ignoreDocumentClick?n._ignoreDocumentClick=!1:n.close())},"open"),this._domEvent.on(t,"resize",function(){n._resize()},"open"),this._domEvent.on(e,"keypress",function(t){27===t.keyCode&&n.close()},"open"),this._domEvent.on(this._container,"click",function(t){t.button||(n._ignoreDocumentClick=!0)},"open");var i=this._elem("days"),o=this._elem("months"),r=this._elem("years");this._onwheelmonths=function(t){var e=0;t.deltaY>0?e=1:t.deltaY<0&&(e=-1),e&&(n._monthSelector(n._currentDate.month+e,!0),t.preventDefault())},this._onwheelyears=function(t){var e=0;t.deltaY>0?e=1:t.deltaY<0&&(e=-1),e&&(n._yearSelector(n._currentDate.year+e,!0),t.preventDefault())},this._domEvent.onWheel(i,this._onwheelmonths,"open"),this._domEvent.onWheel(o,this._onwheelmonths,"open"),this._domEvent.onWheel(r,this._onwheelyears,"open"),this._domEvent.on(o,"click",function(t){t.button||p(t.target,l("month"))&&n._monthSelector(+f(t.target,"month"),!0)},"open"),this._domEvent.on(r,"click",function(t){if(!t.button){var e=f(t.target,"year");e&&n._yearSelector(+e,!0)}},"open"),this._domEvent.on(i,"click",function(t){if(!t.button){var e=l("day","selected"),o=n._currentDate,r=t.target,s=f(r,"day"),a=f(r,"month");if(s){if(p(r,l("day","minmax")))return;if(!p(r,e)){o.day=+s,o.month=+a;var h=i.querySelector("."+e);h&&m(h,e),d(r,e),n.trigger("select",{day:o.day,month:o.month,year:o.year}),n.setting("closeAfterSelection")&&n.close()}}}},"open")},_monthSelector:function(t,e){r>t?t=r:t>s&&(t=s),this._currentDate.month=t;var n,i=this._elem("months"),o=this._elem("month").offsetHeight,a=this._elemAll("days-month"),h=a[t],c=this._elem("month-selector"),u=this._elem("days-container"),f=this._elem("days"),_=l("days","noanim"),p=l("months","noanim");e||(d(f,_),d(i,p));var y=Math.floor(this._currentDate.month*o-o/2);0>=y&&(y=1),y+c.offsetHeight>=i.offsetHeight&&(y=i.offsetHeight-c.offsetHeight-1),this._top(c,y),n=-Math.floor(h.offsetTop-f.offsetHeight/2+h.offsetHeight/2),n>0&&(n=0);var v=f.offsetHeight-u.offsetHeight;v>n&&(n=v),this._top(u,n),this._colorizeMonths(t),e||this._timeout.set(function(){m(f,_),m(i,p)},0,"anim")},_yearSelector:function(t,e){var n=this._data,i=n._startYear,o=n._endYear,r=this._currentDate.year;i>t?t=i:t>o&&(t=o),this._currentDate.year=t;var s=this._elem("years"),a=this._elem("years-container"),h=this._elem("year").offsetHeight,c=this._elem("year-selector"),u=l("years","noanim");e||d(s,u);var f=Math.floor((this._currentDate.year-i)*h),_=-Math.floor((this._currentDate.year-i)*h-s.offsetHeight/2);_>0&&(_=0),_<s.offsetHeight-a.offsetHeight&&(_=s.offsetHeight-a.offsetHeight);var p=0;s.offsetHeight>=a.offsetHeight&&((o-i+1)%2&&(p=h),_=Math.floor((s.offsetHeight-a.offsetHeight-p)/2)),t!==r&&this._rebuildDays(t),this._top(c,f),this._top(a,_),this._colorizeYears(t),e||this._timeout.set(function(){m(s,u)},0,"anim")},_colorizeMonths:function(t){for(var e=this._elemAll("month"),n=5,i=0;n>i;i++)for(var o=this._elemAll("month","color",i),a=0,h=o.length;h>a;a++)m(o[a],l("month","color",i));var c=l("month","color","0");d(e[t],c),t-1>=r&&d(e[t-1],c),s>=t+1&&d(e[t+1],c);var u=1;for(i=t-2;i>=r&&n>u;i--,u++)d(e[i],l("month","color",u));for(u=1,i=t+2;s>=i&&n>u;i++,u++)d(e[i],l("month","color",u))},_colorizeYears:function(t){for(var e=this._elemAll("year"),n=this._data._startYear,i=5,o=0;i>o;o++)for(var r=this._elemAll("year","color",o),s=0,a=r.length;a>s;s++)m(r[s],l("year","color",o));d(e[t-n],l("year","color","0"));var h=1;for(o=t-1;o>=this._data._startYear&&i>h;o--,h++)d(e[o-n],l("year","color",h));for(h=1,o=t+1;o<=this._data._endYear&&i>h;o++,h++)d(e[o-n],l("year","color",h))},_delOpenedEvents:function(){this._domEvent.offAll("open")},_prepareYears:function(t){var e,n,i,o=this._current();return"string"==typeof t&&(e=t.trim().split(/[:,; ]/),n=g(e[0]),i=g(e[1]),isNaN(n)||isNaN(i)||(Math.abs(n)<1e3&&(n=o.year+n),Math.abs(i)<1e3&&(i=o.year+i))),{start:n||o.year-11,end:i||o.year+1}},_updateSelection:function(){var t,e=this._elem("day","selected");e&&m(e,l("day","selected")),this._currentDate.year===this._val.year&&(t=this._elemAll("days-month"),t&&t[this._val.month]&&(e=this._elemAllContext(t[this._val.month],"day"),e&&e[this._val.day-1]&&d(e[this._val.day-1],l("day","selected"))))},_updateButton:function(){var t,e=this.setting("button"),n=this._buttonText();e&&(t=e.tagName.toLowerCase(),"input"===t||"textarea"===t?e.value=n:e.innerHTML=n)},_buttonText:function(){var t=this._currentDate,e=this.text("months"),n=this.text("caseMonths");return t.day+" "+(n||e)[t.month]+" "+t.year}});var l=function(t,e,n){return(null===n||void 0===n)&&(n=""),o+"__"+t+(e?"_"+e+(""===n?"":"_"+n):"")},c=function(t,e){return(null===e||void 0===e)&&(e=""),o+"_"+t+(""===e?"":"_"+e)},u=e.createElement("div"),f=u.dataset?function(t,e){return t.dataset[e]}:function(t,e){return t.getAttribute("data-"+e)},_=!!u.classList,d=_?function(t,e){return t.classList.add(e)}:function(t,e){var n=new RegExp("(^|\\s)"+e+"(\\s|$)","g");n.test(e.className)||(t.className=(t.className+" "+e).replace(/\s+/g," ").replace(/(^ | $)/g,""))},m=_?function(t,e){return t.classList.remove(e)}:function(t,e){var n=new RegExp("(^|\\s)"+e+"(\\s|$)","g");t.className=t.className.replace(n,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")},p=_?function(t,e){return t.classList.contains(e)}:function(t,e){var n=new RegExp("(^|\\s)"+e+"(\\s|$)","g");return-1!==t.className.search(n)};a(h.prototype,{_elem:function(t,e,n){return this._container.querySelector("."+l(t,e,n))},_elemContext:function(t,e,n,i){return t.querySelector("."+l(e,n,i))},_elemAll:function(t,e,n){return this._container.querySelectorAll("."+l(t,e,n))},_elemAllContext:function(t,e,n,i){return t.querySelectorAll("."+l(e,n,i))}});var y=Array.isArray,v=function(t){return"[object Object]"===Object.prototype.toString.call(t)};a(h.prototype,{_left:function(t,e){t.style.left=e+"px"},_top:function(t,e){t.style.top=e+"px"},_position:function(t,e){this._left(t,e.left),this._top(t,e.top)},_offset:function(n){var i={top:0,left:0};return"undefined"!=typeof n.getBoundingClientRect&&(i=n.getBoundingClientRect()),{top:i.top+(t.pageYOffset||e.scrollTop||0)-(e.clientTop||0),left:i.left+(t.pageXOffset||e.scrollLeft||0)-(e.clientLeft||0)}}});var g=function(t){return parseInt(t,10)},b=function(){var t=function(n){if(null===n||void 0===n)return"";var i=[];if(v(n))return e(n);if(y(n)){for(var o=0,r=n.length;r>o;o++)i.push(t(n[o]));return i.join("")}return""+n},e=function(e){var i=e.t||"div",o="<"+i+n(e)+">";return e.c&&(o+=t(e.c)),o+="</"+i+">"},n=function(t){var e=Object.keys(t),n=["cl","class","c","t"],o=t.cl||t["class"],r=[],s="";o&&r.push(i("class",o));for(var a=0,h=e.length;h>a;a++){var l=e[a];-1===n.indexOf(l)&&r.push(i(l,t[l]))}return s=r.join(" "),s?" "+s:""},i=function(t,e){return null!==e&&void 0!==e?t+'="'+(y(e)?e.join(" "):e)+'"':""};return t}(),D=function(){};a(D.prototype,{set:function(t,e,n){this._buf=this._buf||[];var i=setTimeout(t,e);return this._buf.push({id:i,ns:n}),i},clear:function(t){this._buf&&this._buf.forEach(function(e,n){e.id===t&&(clearTimeout(t),this._buf.slice(n,1))},this)},clearAll:function(t){this._buf&&this._buf.forEach(function(e,n){t?t===e.ns&&(clearTimeout(e.id),this._buf.slice(n,1)):this._buf.slice(n,1)},this)}});var E="onwheel"in e.createElement("div")?"wheel":void 0!==e.onmousewheel?"mousewheel":"DOMMouseScroll";a(h.prototype,{on:function(t,e){return t&&e&&(this._eventBuf=this._eventBuf||[],this._eventBuf.push({type:t,callback:e})),this},off:function(t,e){return this._eventBuf&&this._eventBuf.forEach(function(n,i){t===n.type&&e===n.callback&&this._eventBuf.slice(i,1)}),this},trigger:function(t){var e=arguments;return t&&this._eventBuf&&this._eventBuf.forEach(function(n){t===n.type&&n.callback.apply(this,[{type:t}].concat(Array.prototype.slice.call(e,1)))},this),this}});var $=function(){};a($.prototype,{onWheel:function(e,n,i){return this.on(e,"DOMMouseScroll"===E?"MozMousePixelScroll":E,"wheel"===E?n:function(e){e||(e=t.event);var i={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"===e.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}},o=-1/40;return"mousewheel"===E?(i.deltaY=o*e.wheelDelta,e.wheelDeltaX&&(i.deltaX=o*e.wheelDeltaX)):i.deltaY=e.detail,n(i)},i),this},on:function(t,e,n,i){return t&&e&&n&&(t.addEventListener(e,n,!1),this._buf=this._buf||[],this._buf.push({elem:t,type:e,callback:n,ns:i})),this},off:function(t,e,n,i){return t&&e&&n&&this._buf&&this._buf.forEach(function(o,r){o&&o.type===e&&o.elem===t&&o.callback===n&&o.ns===i&&(t.removeEventListener(e,n,!1),this._buf.slice(r,1))},this),this},offAll:function(t){return this._buf&&(this._buf.forEach(function(e){e&&this.off(e.elem,e.type,e.callback,t||e.ns)},this),t||(this._buf=[])),this}});var w=6,x=0;return a(h.prototype,{template:function(t){var e=this._templates;return e._prepare(b(e[t]()))},_templates:{_prepare:function(t){return t.replace(/\$/g,o+"__")},days:function(){for(var t=[],e=r;s>=e;e++)t.push(this.month(e,this.parent._currentDate.year));return t},weekdays:function(){for(var t=this.parent.text("firstWeekDay")||0,e={first:t,last:t?t-1:w},n=t,i=0;7>i;i++)e[n]=i,n++,n>w&&(n=x);return e},month:function(t,e){var o=new Date(e,t,1,12,0,0,0),r=o.getTime(),s=new Date,a=function(t,e,n){var i=_._val;return t===i.day&&e===i.month&&n===i.year},h=function(t){return t.year?new Date(t.year,t.month,t.day,12,0,0,0).getTime():null},l=function(){var i=function(t){return g(""+t.year+n(t.month))},o=i(b),r=i(D),s=g(""+e+n(t)),a="";return(b&&o>s||D&&s>r)&&(a="$days-title-month_minmax"),{cl:["$days-title-month",a],c:y}};s.setHours(12),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0);for(var c,u,f,_=this.parent,d=o.getDay(),m=this.weekdays(),p=m[d],y=_.text("months")[t],v=[31,i(e)?29:28,31,30,31,30,31,31,30,31,30,31],b=_.setting("min"),D=_.setting("max"),E=h(b),$=h(D),k=s.getTime(),M={t:"tr",c:[d!==m.first?{t:"td",colspan:p,cl:"$empty",c:3>p?"":l()}:""]},A=M,H={cl:"$days-month",c:[3>p?l():"",{t:"table",cl:"$days-table",c:[A]}]},S=1;S<=v[t];S++)c="",o.setDate(S),d=o.getDay(),u=this.parent.getHoliday(S,t,e),f=["$day",d===x||d===w?"$day_holiday":"$day_workday"],0===u?f.push("$day_nonholiday"):1===u&&f.push("$day_highday"),a(S,t,e)&&f.push("$day_selected"),k===r&&(f.push("$day_now"),c=_.text("today")),(E&&E>r||$&&r>$)&&f.push("$day_minmax"),d===m.first&&(A={t:"tr",c:[]},H.c[1].c.push(A)),A.c.push({t:"td",cl:f,title:c,"data-month":t,"data-day":S,c:S});return H},years:function(){for(var t=this.parent._data,e=t._startYear,n=t._endYear,i=[{cl:"$year-selector",c:{cl:"$year-selector-i"}}],o=e;n>=o;o++)i.push({cl:"$year","data-year":o,c:o});return i},months:function(){var t=[{cl:"$month-selector",c:{cl:"$month-selector-i"}}];return this.parent.text("months").forEach(function(e,n){t.push({cl:"$month","data-month":n,c:e})}),t},main:function(){var t=this.parent.text("firstWeekDay")||x,e=[];return this.parent.text("shortWeekDays").forEach(function(n,i,o){e.push({cl:["$short-weekdays-cell","$short-weekdays-cell_n_"+t],title:o[t],c:o[t]}),t++,t>w&&(t=x)},this),[{cl:"$short-weekdays",c:e},{cl:"$container",c:[{cl:"$days",c:{cl:"$days-container",c:this.days()}},{cl:"$months",c:this.months()},{cl:"$years",c:{cl:"$years-container",c:this.years()}}]}]}}}),a(h,{addHolidays:function(t,e){this._holidays=this._holidays||{},this._holidays[t]=e}}),h.prototype.getHoliday=function(t,e,n){var i=this._data.locale,o=h._holidays;return o&&o[i]&&o[i][n]?o[i][n][t+"-"+(e+1)]:void 0},a(h.prototype,{_parseDate:function(t){var e,n,i=null;return t&&("string"==typeof t?(e=/^\s*(\d{4})[-/.](\d\d)(?:[-/.](\d\d))?\s*$/.exec(t),e?n=[e[3],e[2]-1,e[1]]:(e=/^\s*(\d{1,2})[-/.](\d{1,2})(?:[-/.](\d{4}|\d\d))?\s*$/.exec(t),e&&(n=[e[1],e[2]-1,e[3]])),n&&(i=new Date(g(n[2]),g(n[1]),g(n[0])))):"object"==typeof t?t instanceof Date?i=t:t.year&&t.day&&(i=new Date(t.year,t.month-1,t.day,12,0,0,0)):"number"==typeof number&&(i=new Date(t))),i},_parseDateToObj:function(t){var e=this._parseDate(t);return e?{day:e.getDate(),month:e.getMonth(),year:e.getFullYear()}:{}}}),a(h,{_texts:{},_locales:[],addLocale:function(t,e){this._locales.push(t),this._texts[t]=e,e.def&&(this._defaultLocale=t)}}),h.prototype.text=function(t){return h._texts[this._data.locale][t]},h}(this,this.document);